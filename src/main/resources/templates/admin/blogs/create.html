<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<meta http-equiv="X-UA-Compatible" content="ie=edge" />

	<title>Cleanex - Blog Management</title>

	<link rel="stylesheet" href="../../back/css/bootstrap.min.css" />
	<link rel="stylesheet" href="../../back/css/lineicons.css" />
	<link rel="stylesheet" href="../../back/css/materialdesignicons.min.css" />
	<link rel="stylesheet" href="../../back/css/fullcalendar.css" />
	<link rel="stylesheet" href="../../back/css/main.css" />
	<link rel="stylesheet" href="https://cdn.ckeditor.com/ckeditor5/43.2.0/ckeditor5.css" />

</head>

<body>
	<div id="preloader">
		<div class="spinner"></div>
	</div>

	<!-- ASIDE -->
	<aside class="sidebar-nav-wrapper" th:replace="~{admin/fragment/aside::adminAside}"></aside>

	<div class="overlay"></div>
	<main class="main-wrapper">

		<!-- HEADER -->
		<header th:replace="~{admin/fragment/header::adminHeader}"></header>

		<div class="mx-5 mt-5">
			<h2 class="mb-4">Write a blog</h2>
			<div th:if="${catchError}" class="error-message" th:text="${catchError}"></div>
			<form th:action="@{/admin/blogs/createBlog}" method="post" th:object="${new_item}"
				enctype="multipart/form-data" class="mt-3">
				<div id="editor"></div>
				<button type="submit" class="btn btn-success mt-3">Submit</button>
			</form>

			<div>
				<textarea class="form-control" id="editor"></textarea>
			</div>

			<div>
				<input class="form-control" type="text" id="image" placeholder="Chosen file URL" readonly />
				<button class="btn btn-primary" id="choose">Choose file</button>
				<div id="ckbox"></div>
			</div>
		</div>
	</main>

	<script type="module">
		import {
			ClassicEditor,
			CKBox,
			Essentials,
			Bold,
			Italic,
			Font,
			Paragraph
		} from 'ckeditor5';

		// Function to initialize CKEditor
		async function initializeEditor() {
			try {
				await ClassicEditor.create(document.querySelector('#editor'), {
					plugins: [CKBox, Essentials, Bold, Italic, Font, Paragraph],
					ckbox: {
						tokenUrl: `${location.origin}/ckbox/auth`, // Endpoint to fetch CKBox token
						theme: 'lark',
						allowExternalImagesEditing: [/^data:/, 'origin', /ckbox/]
					},
					toolbar: [
						'ckbox', '|', 'undo', 'redo', '|', 'bold', 'italic', '|',
						'fontSize', 'fontFamily', 'fontColor', 'fontBackgroundColor'
					]
				});
			} catch (error) {
				console.error('Error initializing CKEditor:', error);
			}
		}

		// Function to initialize CKBox file chooser
		function initializeFileChooser() {
			document.getElementById('choose').addEventListener('click', function () {
				CKBox.mount(document.querySelector('#ckbox'), {
					tokenUrl: `${location.origin}/ckbox/auth`, // Endpoint to fetch CKBox token
					dialog: true,
					assets: {
						onChoose: (assets) => {
							// Populate the input field with the chosen file's URL
							const fileInput = document.getElementById('file-url');
							if (assets.length > 0) {
								fileInput.value = assets[0].data.url;
								assets.forEach(asset => {
									console.log('Chosen asset URL:', asset.data.url);
								});
							} else {
								console.log('No assets chosen.');
							}
						}
					}
				});
			});
		}

		// Initialize both CKEditor and CKBox when the DOM is ready
		document.addEventListener('DOMContentLoaded', () => {
			initializeEditor();
			initializeFileChooser();
		});
	</script>
	
	<script src="../../back/js/bootstrap.bundle.min.js"></script>
	<script src="../../back/js/Chart.min.js"></script>
	<script src="../../back/js/dynamic-pie-chart.js"></script>
	<script src="../../back/js/moment.min.js"></script>
	<script src="../../back/js/fullcalendar.js"></script>
	<script src="../../back/js/jvectormap.min.js"></script>
	<script src="../../back/js/world-merc.js"></script>
	<script src="../../back/js/polyfill.js"></script>
	<script src="../../back/js/main.js"></script>
	<script src="../../back/js/blog-form.js" type="module"></script>

</body>

</html>